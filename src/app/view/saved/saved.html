<dev-theme-toggle></dev-theme-toggle>
<app-navbar></app-navbar>

<div class="saved-items-container">
    <profile-button></profile-button>

    <div class="items-list-section">
        <div class="section-header">
            <h2 class="section-title">Elementos guardados</h2>

            <div class="item-type-selector">
                <button class="type-button" [class.active]="selectedType() === 'lugares'" (click)="selectType('lugares')">
                    Lugares
                </button>
                <button class="type-button" [class.active]="selectedType() === 'vehiculos'" (click)="selectType('vehiculos')">
                    Vehículos
                </button>
                <button class="type-button" [class.active]="selectedType() === 'rutas'" (click)="selectType('rutas')">
                    Rutas
                </button>
            </div>

            @if (items() && items()!.length > 0) {
                <div class="pagination">
                    <span class="page-info">Página {{ currentPage() }} de {{ totalPages() }}</span>
                    <div class="pagination-buttons">
                        <button mat-icon-button (click)="previousPage()" [disabled]="currentPage() === 1">
                            <mat-icon>chevron_left</mat-icon>
                        </button>
                        <button mat-icon-button (click)="nextPage()" [disabled]="currentPage() === totalPages()">
                            <mat-icon>chevron_right</mat-icon>
                        </button>
                    </div>
                </div>
            }
        </div>

        @if (items() && items().length > 0) {

            <div class="items-list">
                @switch (selectedType()) {

                    @case ('lugares') {
                        @for (item of paginatedItems(); track item.geohash) {
                            <div class="item-card"
                                 (click)="selectItem(item)"
                                 [class.selected]="selectedItem?.geohash === item.geohash">
                                <div class="item-icon">
                                    <img ngSrc="assets/images/poi_active.png" height="44" width="33" priority class="poi-icon-img"
                                         [class.visible]="selectedItem?.geohash === item.geohash" alt="active POI">
                                    <img ngSrc="assets/images/poi_inactive.png" priority height="44" width="33" class="poi-icon-img"
                                         [class.visible]="selectedItem?.geohash !== item.geohash" alt="inactive POI">
                                </div>
                                <div class="item-info">
                                    <h3 class="item-name">{{ getDisplayName(item) }}</h3>
                                    @if (getDisplayName(item) !== item.placeName) {
                                        <p class="item-place-if-alias">{{ item.placeName }}</p>
                                    }
                                    <p class="item-description">({{ item.lat | number:'1.2-4' }}, {{ item.lon | number:'1.2-4' }})</p>
                                </div>
                                <button mat-icon-button class="favorite-button" [class.pinned]="item.pinned" (click)="toggleFavorite(item, $event)">
                                    <mat-icon>{{ item.pinned ? 'star' : 'star_border' }}</mat-icon>
                                </button>
                            </div>
                        }
                    }

                    @case ('vehiculos') {
                        @for (item of paginatedItems(); track item.matricula) {
                            <div class="item-card"
                                 (click)="selectItem(item)"
                                 [class.selected]="selectedItem?.matricula === item.matricula">
                                <div class="item-icon">
                                    <img ngSrc="assets/images/vehicle/vehicle_on.png" height="50" width="50" priority class="poi-icon-img"
                                         [class.visible]="selectedItem?.matricula === item.matricula" alt="active vehicle">
                                    <img ngSrc="assets/images/vehicle/vehicle_off.png" priority height="50" width="50" class="poi-icon-img"
                                         [class.visible]="selectedItem?.matricula !== item.matricula" alt="inactive vehicle">
                                </div>
                                <div class="item-info">
                                    <h3 class="item-name">{{ getDisplayName(item) }}</h3>
                                    <p class="item-description" style="font-weight: 500;">{{ item.matricula }}</p>
                                    <p class="item-description">{{ item.marca }} {{ item.modelo }} {{ item.anyo }}</p>
                                </div>
                                <button mat-icon-button class="favorite-button" [class.pinned]="item.pinned" (click)="toggleFavorite(item, $event)">
                                    <mat-icon>{{ item.pinned ? 'star' : 'star_border' }}</mat-icon>
                                </button>
                            </div>
                        }
                    }

                    @case ('rutas') {
                        @for (item of paginatedItems(); track getRouteId(item)) {
                            <div class="item-card"
                                 (click)="selectItem(item)"
                                 [class.selected]="getRouteId(selectedItem) === getRouteId(item)">

                                <div class="item-icon">
                                    <img ngSrc="assets/images/route/route_on.svg" height="58" width="52" priority class="poi-icon-img"
                                         [class.visible]="getRouteId(selectedItem) === getRouteId(item)" alt="active route">
                                    <img ngSrc="assets/images/route/route_off.svg" priority height="58" width="52" class="poi-icon-img"
                                         [class.visible]="getRouteId(selectedItem) !== getRouteId(item)" alt="inactive route">
                                </div>

                                <div class="item-info">
                                    <h3 class="item-name">{{ item.alias }}</h3>

                                    <p class="item-description">
                                        {{ (item.tiempo / 3600).toFixed(1) }} h • {{ (item.distancia / 1000).toFixed(1) }} km
                                    </p>

                                    <p class="item-description" style="font-weight: 500;">
                                        {{ getTransportLabel(item.transporte) | titlecase }}
                                    </p>
                                </div>

                                <button mat-icon-button class="favorite-button" [class.pinned]="item.pinned" (click)="toggleFavorite(item, $event)">
                                    <mat-icon>{{ item.pinned ? 'star' : 'star_border' }}</mat-icon>
                                </button>
                            </div>
                        }
                    }
                }
            </div>

        } @else {
            <div class="empty-state">
                <mat-icon class="empty-icon">bookmark_border</mat-icon>
                <p class="empty-message">{{ emptyMessage() }}</p>
            </div>
        }
    </div>

    <div class="details-container">
        @if (!selectedItem) {
            <div class="empty-selection-placeholder">
                <p>Selecciona un elemento para ver sus detalles.</p>
            </div>
        } @else {
            @if (isDesktop()) {
                @switch (selectedType()) {
                    @case ('lugares') {
                        <app-saved-poi-dialog
                            [item]="selectedItem"
                            [displayName]="getDisplayName(selectedItem)"
                            (actionEvent)="handleDialogActions($event)"
                            (closeEvent)="deselectItem()">
                        </app-saved-poi-dialog>
                    }
                    @case ('vehiculos') {
                        <app-saved-vehicle-dialog
                            [item]="selectedItem"
                            [displayName]="getDisplayName(selectedItem)"
                            (actionEvent)="handleDialogActions($event)"
                            (closeEvent)="deselectItem()">
                        </app-saved-vehicle-dialog>
                    }
                }
            }
        }
    </div>
</div>
